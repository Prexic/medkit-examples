<!doctype html>
<html>
  <head>
    <title>Viewer-Facing Page</title>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width,initial-scale=1.0">

    <!-- A real extension would not be able to link to external CDNs; we just do it here for simplicity -->
    <script src="//cdnjs.cloudflare.com/ajax/libs/lodash.js/4.17.4/lodash.min.js"></script>

    <!--
      Twitch only allows loading assets from certain white-listed domains. Above we reference a font
      from Google's font CDN. Here we load the latest version of Muxy's JavaScript SDK. You can
      reference specific versions by replacing `latest` with a version number (e.g. `2.0.0`), or keep
      this as-is to automatically load the most recent version.
    -->
    <script src="//ext-cdn.muxy.io/medkit/latest/medkit.umd.js"></script>

    <!--
      Here is the entire code block needed to power the panel. It uses Muxy's state loading to get
      the last sent message, and easy event binding to get notified when a new message is sent.
    -->
    <script type="text/javascript">
      /*
       * Here you can set any values to be used when the extension is being debugged. You can safely
       * leave these calls in, as they will be overridden by the actual information provided in a
       * production environment. (The channel and user IDs are particularly useful).
       */
      const opts = new Muxy.DebuggingOptions();
      opts.role('viewer').channelID('12345').userID('67890');
      Muxy.debug(opts);

      Muxy.setup({
        clientID: 'replaceme'
      });
      const sdk = new Muxy.SDK();

      /*
       * Here we are using lodash to throttles calls to this function, so if it is called more than
       * once in a short period of time, only one instance will be called.
       */
      const increment = _.debounce(function () {
        /*
         * This sends data to be accumulated by the server.  We're not sending any actual data in our
         * accumulated objects here - we're just going to count the number of objects that have accumulated.
         */
        sdk.accumulate('simple_counter', {});
      }, 250);

      document.querySelector('#increment').addEventListener('click', increment);
    </script>
  </head>

  <body>
    <p>Pressing 'Increment' will send an accumulation request.</p>

    <button id="increment">Increment</button>
  </body>
</html>
